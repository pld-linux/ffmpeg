--- ffmpeg/libavcodec/libpostproc/Makefile.orig	2006-01-27 00:42:28.000000000 +0100
+++ ffmpeg/libavcodec/libpostproc/Makefile	2006-01-29 13:37:17.993360000 +0100
@@ -4,25 +4,22 @@
 VPATH=$(SRC_PATH)/libavcodec/libpostproc
 
 NAME=postproc
-ifeq ($(BUILD_SHARED),yes)
 LIBVERSION=$(SPPVERSION)
 LIBMAJOR=$(SPPMAJOR)
-endif
 
-OBJS=postprocess.o
-SOBJS=postprocess_pic.o
+OBJS=postprocess.lo
 
 CFLAGS  = $(OPTFLAGS) $(MLIB_INC) -I. -I.. $(EXTRA_INC)
 # -I/usr/X11R6/include/
 
 .SUFFIXES: .c .o
 
 # .PHONY: all clean
 
-.c.o:
-	$(CC) -c $(CFLAGS) $(LIBOBJFLAGS) -I$(SRC_PATH)/libavcodec -I../.. -o $@ $<
+%.lo : %.c
+	libtool --mode=compile $(CC) -c $(CFLAGS) $(LIBOBJFLAGS) -I$(SRC_PATH)/libavcodec -I../.. -o $@ $<
 
-all:    $(SWSLIB) $(LIB) $(SLIBNAME)
+all:    $(SWSLIB) $(LIB)
 
 clean:
 	rm -f *.o *.d *~ *.a *.lib *.so *.dylib *.dll
@@ -36,37 +33,21 @@
 	$(CC) -MM $(CFLAGS) postprocess.c 1>.depend
 
 ifeq ($(BUILD_SHARED),yes)
-postprocess_pic.o: postprocess.c
-	$(CC) -c $(CFLAGS) -fomit-frame-pointer -fPIC -DPIC -I.. -I../.. -o $@ $<
-
-$(SLIBNAME): $(SOBJS)
-	$(CC) $(SHFLAGS) -o $(SLIBNAME) $(SOBJS)
+RPATH= -rpath $(libdir)
+else
+RPATH=
 endif
 
 $(LIB): $(OBJS)
-	rm -f $@
-	$(AR) rc $@ $(OBJS)
-	$(RANLIB) $@
+	libtool --mode=link $(CC) -o $(LIB) $(OBJS) $(RPATH) -version-number `echo $(LIBVERSION) | tr . :`
 
 install: all
-ifeq ($(BUILD_SHARED),yes)
-ifeq ($(CONFIG_WIN32),yes)
-	install $(INSTALLSTRIP) -m 755 $(SLIBNAME) "$(prefix)"
-else
-	install -d $(libdir)
-	install $(INSTALLSTRIP) -m 755 $(SLIBNAME) \
-		$(libdir)/$(SLIBNAME_WITH_VERSION)
-	ln -sf $(SLIBNAME_WITH_VERSION) \
-		$(libdir)/$(SLIBNAME_WITH_MAJOR)
-	ln -sf $(SLIBNAME_WITH_VERSION) \
-		$(libdir)/$(SLIBNAME)
-	$(LDCONFIG) || true
-endif
-endif
-	mkdir -p $(prefix)/include/postproc
-	install -m 644 $(SRC_PATH)/libavcodec/libpostproc/postprocess.h $(prefix)/include/postproc/postprocess.h
-	install -d $(libdir)/pkgconfig
-	install -m 644 ../../libpostproc.pc $(libdir)/pkgconfig
+	install -d $(DESTDIR)$(libdir)
+	libtool --mode=install install $(INSTALLSTRIP) $(LIB) $(DESTDIR)$(libdir)
+	install -d $(DESTDIR)$(prefix)/include/postproc
+	install -m 644 $(SRC_PATH)/libavcodec/libpostproc/postprocess.h $(DESTDIR)$(prefix)/include/postproc/postprocess.h
+	install -d $(DESTDIR)$(libdir)/pkgconfig
+	install -m 644 ../../libpostproc.pc $(DESTDIR)$(libdir)/pkgconfig
 
 
 #
--- ffmpeg/libavcodec/Makefile.orig	2006-01-27 00:42:28.000000000 +0100
+++ ffmpeg/libavcodec/Makefile	2006-01-29 13:45:46.901164750 +0100
@@ -9,311 +9,312 @@
 # NOTE: -I.. is needed to include config.h
 CFLAGS=$(OPTFLAGS) -DHAVE_AV_CONFIG_H -I.. -I$(SRC_PATH)/libavutil -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_GNU_SOURCE $(AMR_CFLAGS)
 
-OBJS= bitstream.o utils.o mem.o allcodecs.o \
-      mpegvideo.o jrevdct.o jfdctfst.o jfdctint.o\
-      mpegaudio.o ac3enc.o mjpeg.o resample.o resample2.o dsputil.o \
-      motion_est.o imgconvert.o imgresample.o \
-      mpeg12.o mpegaudiodec.o pcm.o simple_idct.o \
-      ratecontrol.o adpcm.o eval.o error_resilience.o \
-      fft.o mdct.o raw.o golomb.o cabac.o\
-      dpcm.o adx.o faandct.o parser.o g726.o \
-      vp3dsp.o h264idct.o rangecoder.o pnm.o h263.o msmpeg4.o h263dec.o \
-      opt.o
+OBJS= bitstream.lo utils.lo mem.lo allcodecs.lo \
+      mpegvideo.lo jrevdct.lo jfdctfst.lo jfdctint.lo\
+      mpegaudio.lo ac3enc.lo mjpeg.lo resample.lo resample2.lo dsputil.lo \
+      motion_est.lo imgconvert.lo imgresample.lo \
+      mpeg12.lo mpegaudiodec.lo pcm.lo simple_idct.lo \
+      ratecontrol.lo adpcm.lo eval.lo error_resilience.lo \
+      fft.lo mdct.lo raw.lo golomb.lo cabac.lo\
+      dpcm.lo adx.lo faandct.lo parser.lo g726.lo \
+      vp3dsp.lo h264idct.lo rangecoder.lo pnm.lo h263.lo msmpeg4.lo h263dec.lo \
+      opt.lo
 
 ifeq ($(CONFIG_AASC_DECODER),yes)
-    OBJS+= aasc.o
+    OBJS+= aasc.lo
 endif
 ifeq ($(CONFIG_ALAC_DECODER),yes)
-    OBJS+= alac.o
+    OBJS+= alac.lo
 endif
 ifneq ($(CONFIG_ASV1_DECODER)$(CONFIG_ASV1_ENCODER)$(CONFIG_ASV2_DECODER)$(CONFIG_ASV2_ENCODER),)
-    OBJS+= asv1.o
+    OBJS+= asv1.lo
 endif
 ifeq ($(CONFIG_CINEPAK_DECODER),yes)
-    OBJS+= cinepak.o
+    OBJS+= cinepak.lo
 endif
 ifeq ($(CONFIG_COOK_DECODER),yes)
-    OBJS+= cook.o
+    OBJS+= cook.lo
 endif
 ifneq ($(CONFIG_CLJR_DECODER)$(CONFIG_CLJR_ENCODER),)
-    OBJS+= cljr.o
+    OBJS+= cljr.lo
 endif
 ifeq ($(CONFIG_CYUV_DECODER),yes)
-    OBJS+= cyuv.o
+    OBJS+= cyuv.lo
 endif
 ifeq ($(CONFIG_DVBSUB_DECODER),yes)
-   OBJS+= dvbsubdec.o
+   OBJS+= dvbsubdec.lo
 endif
 ifeq ($(CONFIG_DVBSUB_ENCODER),yes)
-   OBJS+= dvbsub.o
+   OBJS+= dvbsub.lo
 endif
 ifeq ($(CONFIG_DVDSUB_DECODER),yes)
-   OBJS+= dvdsub.o
+   OBJS+= dvdsub.lo
 endif
 ifeq ($(CONFIG_DVDSUB_ENCODER),yes)
-   OBJS+= dvdsubenc.o
+   OBJS+= dvdsubenc.lo
 endif
 ifneq ($(CONFIG_DVVIDEO_DECODER)$(CONFIG_DVVIDEO_ENCODER),)
-    OBJS+= dv.o
+    OBJS+= dv.lo
 endif
 ifeq ($(CONFIG_EIGHTBPS_DECODER),yes)
-    OBJS+= 8bps.o
+    OBJS+= 8bps.lo
 endif
 ifneq ($(CONFIG_FFV1_DECODER)$(CONFIG_FFV1_ENCODER),)
-    OBJS+= ffv1.o
+    OBJS+= ffv1.lo
 endif
 ifeq ($(CONFIG_FLAC_DECODER),yes)
-    OBJS+= flac.o
+    OBJS+= flac.lo
 endif
 ifeq ($(CONFIG_FLIC_DECODER),yes)
-    OBJS+= flicvideo.o
+    OBJS+= flicvideo.lo
 endif
 ifeq ($(CONFIG_FOURXM_DECODER),yes)
-    OBJS+= 4xm.o
+    OBJS+= 4xm.lo
 endif
 ifeq ($(CONFIG_FRAPS_DECODER),yes)
-    OBJS+= fraps.o
+    OBJS+= fraps.lo
 endif
 ifneq ($(CONFIG_H261_DECODER)$(CONFIG_H261_ENCODER),)
-    OBJS+= h261.o
+    OBJS+= h261.lo
 endif
 ifneq ($(CONFIG_H264_DECODER)$(CONFIG_SVQ3_DECODER),)
-    OBJS+= h264.o
+    OBJS+= h264.lo
 endif
 ifneq ($(CONFIG_HUFFYUV_DECODER)$(CONFIG_HUFFYUV_ENCODER)$(CONFIG_FFVHUFF_DECODER)$(CONFIG_FFVHUFF_ENCODER),)
-    OBJS+= huffyuv.o
+    OBJS+= huffyuv.lo
 endif
 ifeq ($(CONFIG_IDCIN_DECODER),yes)
-    OBJS+= idcinvideo.o
+    OBJS+= idcinvideo.lo
 endif
 ifeq ($(CONFIG_INDEO2_DECODER),yes)
-    OBJS+= indeo2.o
+    OBJS+= indeo2.lo
 endif
 ifeq ($(CONFIG_INDEO3_DECODER),yes)
-    OBJS+= indeo3.o
+    OBJS+= indeo3.lo
 endif
 ifeq ($(CONFIG_INTERPLAY_VIDEO_DECODER),yes)
-    OBJS+= interplayvideo.o
+    OBJS+= interplayvideo.lo
 endif
 ifneq ($(CONFIG_MSZH_DECODER)$(CONFIG_ZLIB_DECODER)$(CONFIG_ZLIB_ENCODER),)
-    OBJS+= lcl.o
+    OBJS+= lcl.lo
 endif
 ifeq ($(CONFIG_LOCO_DECODER),yes)
-    OBJS+= loco.o
+    OBJS+= loco.lo
 endif
 ifneq ($(CONFIG_MACE3_DECODER)$(CONFIG_MACE6_DECODER),)
-    OBJS+= mace.o
+    OBJS+= mace.lo
 endif
 ifeq ($(CONFIG_MSRLE_DECODER),yes)
-    OBJS+= msrle.o
+    OBJS+= msrle.lo
 endif
 ifeq ($(CONFIG_MSVIDEO1_DECODER),yes)
-    OBJS+= msvideo1.o
+    OBJS+= msvideo1.lo
 endif
 ifneq ($(CONFIG_PNG_DECODER)$(CONFIG_PNG_ENCODER),)
-    OBJS+= png.o
+    OBJS+= png.lo
 endif
 ifeq ($(CONFIG_QDM2_DECODER),yes)
-    OBJS+= qdm2.o
+    OBJS+= qdm2.lo
 endif
 ifeq ($(CONFIG_QDRAW_DECODER),yes)
-    OBJS+= qdrw.o
+    OBJS+= qdrw.lo
 endif
 ifeq ($(CONFIG_QPEG_DECODER),yes)
-    OBJS+= qpeg.o
+    OBJS+= qpeg.lo
 endif
 ifeq ($(CONFIG_QTRLE_DECODER),yes)
-    OBJS+= qtrle.o
+    OBJS+= qtrle.lo
 endif
 ifeq ($(CONFIG_RA_144_DECODER),yes)
-    OBJS+= ra144.o
+    OBJS+= ra144.lo
 endif
 ifeq ($(CONFIG_RA_288_DECODER),yes)
-    OBJS+= ra288.o
+    OBJS+= ra288.lo
 endif
 ifeq ($(CONFIG_ROQ_DECODER),yes)
-    OBJS+= roqvideo.o
+    OBJS+= roqvideo.lo
 endif
 ifeq ($(CONFIG_RPZA_DECODER),yes)
-    OBJS+= rpza.o
+    OBJS+= rpza.lo
 endif
 ifneq ($(CONFIG_RV10_DECODER)$(CONFIG_RV20_DECODER)$(CONFIG_RV10_ENCODER)$(CONFIG_RV20_ENCODER),)
-    OBJS+= rv10.o
+    OBJS+= rv10.lo
 endif
 ifeq ($(CONFIG_SHORTEN_DECODER),yes)
-    OBJS+= shorten.o
+    OBJS+= shorten.lo
 endif
 ifeq ($(CONFIG_SMC_DECODER),yes)
-    OBJS+= smc.o
+    OBJS+= smc.lo
 endif
 ifneq ($(CONFIG_SNOW_DECODER)$(CONFIG_SNOW_ENCODER),)
-    OBJS+= snow.o
+    OBJS+= snow.lo
 endif
 ifneq ($(CONFIG_SONIC_DECODER)$(CONFIG_SONIC_ENCODER)$(CONFIG_SONIC_LS_ENCODER),)
-    OBJS+= sonic.o
+    OBJS+= sonic.lo
 endif
 ifneq ($(CONFIG_SVQ1_DECODER)$(CONFIG_SVQ1_ENCODER),)
-    OBJS+= svq1.o
+    OBJS+= svq1.lo
 endif
 ifeq ($(CONFIG_TRUEMOTION1_DECODER),yes)
-    OBJS+= truemotion1.o
+    OBJS+= truemotion1.lo
 endif
 ifeq ($(CONFIG_TRUEMOTION2_DECODER),yes)
-    OBJS+= truemotion2.o
+    OBJS+= truemotion2.lo
 endif
 ifeq ($(CONFIG_TRUESPEECH_DECODER),yes)
-    OBJS+= truespeech.o
+    OBJS+= truespeech.lo
 endif
 ifeq ($(CONFIG_TSCC_DECODER),yes)
-    OBJS+= tscc.o
+    OBJS+= tscc.lo
 endif
 ifeq ($(CONFIG_CSCD_DECODER),yes)
-    OBJS+= cscd.o
-    OBJS+= lzo.o
+    OBJS+= cscd.lo
+    OBJS+= lzo.lo
 endif
 ifeq ($(CONFIG_ULTI_DECODER),yes)
-    OBJS+= ulti.o
+    OBJS+= ulti.lo
 endif
 ifneq ($(CONFIG_VC9_DECODER)$(CONFIG_WMV3_DECODER),)
-    OBJS+= vc9.o
+    OBJS+= vc9.lo
 endif
 ifneq ($(CONFIG_VCR1_DECODER)$(CONFIG_VCR1_ENCODER),)
-    OBJS+= vcr1.o
+    OBJS+= vcr1.lo
 endif
 ifneq ($(CONFIG_VMDVIDEO_DECODER)$(CONFIG_VMDAUDIO_DECODER),)
-    OBJS+= vmdav.o
+    OBJS+= vmdav.lo
 endif
 ifeq ($(CONFIG_VORBIS_DECODER),yes)
-    OBJS+= vorbis.o
+    OBJS+= vorbis.lo
 endif
 ifneq ($(CONFIG_VP3_DECODER)$(CONFIG_THEORA_DECODER),)
-    OBJS+= vp3.o
+    OBJS+= vp3.lo
 endif
 ifeq ($(CONFIG_VQA_DECODER),yes)
-    OBJS+= vqavideo.o
+    OBJS+= vqavideo.lo
 endif
 ifneq ($(CONFIG_WMAV1_DECODER)$(CONFIG_WMAV2_DECODER),)
-    OBJS+= wmadec.o
+    OBJS+= wmadec.lo
 endif
 ifeq ($(CONFIG_WNV1_DECODER),yes)
-    OBJS+= wnv1.o
+    OBJS+= wnv1.lo
 endif
 ifeq ($(CONFIG_WS_SND1_DECODER),yes)
-    OBJS+= ws-snd1.o
+    OBJS+= ws-snd1.lo
 endif
 ifneq ($(CONFIG_XAN_WC3_DECODER)$(CONFIG_XAN_WC4_DECODER),)
-    OBJS+= xan.o
+    OBJS+= xan.lo
 endif
 ifeq ($(CONFIG_XL_DECODER),yes)
-    OBJS+= xl.o
+    OBJS+= xl.lo
 endif
 ifeq ($(CONFIG_BMP_DECODER),yes)
-	OBJS+= bmp.o
+	OBJS+= bmp.lo
 endif
 
 AMROBJS=
 ifeq ($(AMR_NB),yes)
 ifeq ($(AMR_NB_FIXED),yes)
-AMROBJS= amr.o
-AMREXTRALIBS+= amr/*.o
+AMROBJS= amr.lo
+AMREXTRALIBS+= amr/*.lo
 AMRLIBS=amrlibs
 CLEANAMR=cleanamr
 else
-AMROBJS= amr.o
-OBJS+= amr_float/sp_dec.o amr_float/sp_enc.o amr_float/interf_dec.o amr_float/interf_enc.o
+AMROBJS= amr.lo
+OBJS+= amr_float/sp_dec.lo amr_float/sp_enc.lo amr_float/interf_dec.lo amr_float/interf_enc.lo
 CLEANAMR=cleanamrfloat
 endif
 endif
 
 ifeq ($(HAVE_PTHREADS),yes)
-OBJS+= pthread.o
+OBJS+= pthread.lo
 endif
 
 ifeq ($(HAVE_W32THREADS),yes)
-OBJS+= w32thread.o
+OBJS+= w32thread.lo
 endif
 
 ifeq ($(HAVE_BEOSTHREADS),yes)
-OBJS+= beosthread.o
+OBJS+= beosthread.lo
 endif
 
 ifeq ($(AMR_WB),yes)
-AMROBJS= amr.o
-OBJS+= amrwb_float/dec_acelp.o amrwb_float/dec_dtx.o amrwb_float/dec_gain.o \
-		amrwb_float/dec_if.o amrwb_float/dec_lpc.o amrwb_float/dec_main.o \
-		amrwb_float/dec_rom.o amrwb_float/dec_util.o amrwb_float/enc_acelp.o \
-		amrwb_float/enc_dtx.o amrwb_float/enc_gain.o amrwb_float/enc_if.o \
-		amrwb_float/enc_lpc.o amrwb_float/enc_main.o amrwb_float/enc_rom.o \
-		amrwb_float/enc_util.o amrwb_float/if_rom.o
+AMROBJS= amr.lo
+OBJS+= amrwb_float/dec_acelp.lo amrwb_float/dec_dtx.lo amrwb_float/dec_gain.lo \
+		amrwb_float/dec_if.lo amrwb_float/dec_lpc.lo amrwb_float/dec_main.lo \
+		amrwb_float/dec_rom.lo amrwb_float/dec_util.lo amrwb_float/enc_acelp.lo \
+		amrwb_float/enc_dtx.lo amrwb_float/enc_gain.lo amrwb_float/enc_if.lo \
+		amrwb_float/enc_lpc.lo amrwb_float/enc_main.lo amrwb_float/enc_rom.lo \
+		amrwb_float/enc_util.lo amrwb_float/if_rom.lo
 endif
 OBJS+= $(AMROBJS)
 CLEANAMRWB=cleanamrwbfloat
 ASM_OBJS=
 
 ifeq ($(HAVE_XVMC_ACCEL),yes)
-OBJS+= xvmcvideo.o
+OBJS+= xvmcvideo.lo
 endif
 
 # currently using liba52 for ac3 decoding
 ifeq ($(CONFIG_AC3),yes)
-OBJS+= a52dec.o
+OBJS+= a52dec.lo
 
 # using builtin liba52 or runtime linked liba52.so.0
 ifneq ($(CONFIG_A52BIN),yes)
-OBJS+= liba52/bit_allocate.o liba52/bitstream.o liba52/downmix.o \
-	liba52/imdct.o  liba52/parse.o liba52/crc.o liba52/resample.o
+OBJS+= liba52/bit_allocate.lo liba52/bitstream.lo liba52/downmix.lo \
+	liba52/imdct.lo  liba52/parse.lo liba52/crc.lo liba52/resample.lo
 endif
 endif
 
-EXTRALIBS += -L../libavutil -lavutil$(BUILDSUF)
+EXTRALIBS += $(SRC_PATH)/libavutil/libavutil.la
 
 # currently using libdts for dts decoding
 ifeq ($(CONFIG_DTS),yes)
-OBJS+= dtsdec.o
+OBJS+= dtsdec.lo
 CFLAGS += $(DTS_INC)
 endif
 
 ifeq ($(CONFIG_FAAD),yes)
-OBJS+= faad.o
+OBJS+= faad.lo
 endif
 
 ifeq ($(CONFIG_FAAC),yes)
-OBJS+= faac.o
+OBJS+= faac.lo
 endif
 
 ifeq ($(CONFIG_XVID),yes)
-OBJS+= xvidff.o
-OBJS+= xvid_rc.o
+OBJS+= xvidff.lo
+OBJS+= xvid_rc.lo
 endif
 
 ifeq ($(CONFIG_X264),yes)
-OBJS+= x264.o
+OBJS+= x264.lo
 endif
 
 ifeq ($(CONFIG_PP),yes)
 ifeq ($(BUILD_SHARED),yes)
-EXTRALIBS += -Llibpostproc -lpostproc$(BUILDSUF)
+EXTRALIBS += libpostproc/libpostproc.la
+EXTRADEPS += libpostproc/libpostproc.la
 else
 # LIBS += libpostproc/libpostproc.a ... should be fixed
-OBJS += libpostproc/postprocess.o
+OBJS += libpostproc/postprocess.lo
 endif
 endif
 
 ifeq ($(CONFIG_MP3LAME),yes)
-OBJS += mp3lameaudio.o
+OBJS += mp3lameaudio.lo
 endif
 
 ifeq ($(CONFIG_LIBOGG),yes)
 ifeq ($(CONFIG_LIBVORBIS),yes)
-OBJS += oggvorbis.o
+OBJS += oggvorbis.lo
 endif
 ifeq ($(CONFIG_LIBTHEORA), yes)
-OBJS += oggtheora.o
+OBJS += oggtheora.lo
 endif
 endif
 
 ifeq ($(CONFIG_LIBGSM),yes)
-OBJS += libgsm.o
+OBJS += libgsm.lo
 endif
 
 ifeq ($(TARGET_GPROF),yes)
@@ -323,33 +324,33 @@
 
 # i386 mmx specific stuff
 ifeq ($(TARGET_MMX),yes)
-OBJS += i386/fdct_mmx.o i386/cputest.o \
-	i386/dsputil_mmx.o i386/mpegvideo_mmx.o \
-	i386/idct_mmx.o i386/motion_est_mmx.o \
-	i386/simple_idct_mmx.o i386/fft_sse.o i386/vp3dsp_mmx.o \
-	i386/vp3dsp_sse2.o
+OBJS += i386/fdct_mmx.lo i386/cputest.lo \
+	i386/dsputil_mmx.lo i386/mpegvideo_mmx.lo \
+	i386/idct_mmx.lo i386/motion_est_mmx.lo \
+	i386/simple_idct_mmx.lo i386/fft_sse.lo i386/vp3dsp_mmx.lo \
+	i386/vp3dsp_sse2.lo
 ifeq ($(CONFIG_GPL),yes)
-OBJS += i386/idct_mmx_xvid.o
+OBJS += i386/idct_mmx_xvid.lo
 endif
 ifdef TARGET_BUILTIN_VECTOR
-i386/fft_sse.o: CFLAGS+= -msse
+i386/fft_sse.lo: CFLAGS+= -msse
 depend: CFLAGS+= -msse
 endif
 endif
 
 # armv4l specific stuff
 ifeq ($(TARGET_ARCH_ARMV4L),yes)
-ASM_OBJS += armv4l/jrevdct_arm.o armv4l/simple_idct_arm.o armv4l/dsputil_arm_s.o
-OBJS += armv4l/dsputil_arm.o armv4l/mpegvideo_arm.o
+ASM_OBJS += armv4l/jrevdct_arm.lo armv4l/simple_idct_arm.lo armv4l/dsputil_arm_s.lo
+OBJS += armv4l/dsputil_arm.lo armv4l/mpegvideo_arm.lo
 ifeq ($(TARGET_IWMMXT),yes)
-OBJS += armv4l/dsputil_iwmmxt.o armv4l/mpegvideo_iwmmxt.o
+OBJS += armv4l/dsputil_iwmmxt.lo armv4l/mpegvideo_iwmmxt.lo
 endif
 endif
 
 # sun mediaLib specific stuff
 # currently only works when libavcodec is used in mplayer
 ifeq ($(HAVE_MLIB),yes)
-OBJS += mlib/dsputil_mlib.o
+OBJS += mlib/dsputil_mlib.lo
 CFLAGS += $(MLIB_INC)
 endif
 
@@ -361,83 +362,73 @@
 
 # alpha specific stuff
 ifeq ($(TARGET_ARCH_ALPHA),yes)
-OBJS += alpha/dsputil_alpha.o alpha/mpegvideo_alpha.o \
-	alpha/simple_idct_alpha.o alpha/motion_est_alpha.o
-ASM_OBJS += alpha/dsputil_alpha_asm.o alpha/motion_est_mvi_asm.o
+OBJS += alpha/dsputil_alpha.lo alpha/mpegvideo_alpha.lo \
+	alpha/simple_idct_alpha.lo alpha/motion_est_alpha.lo
+ASM_OBJS += alpha/dsputil_alpha_asm.lo alpha/motion_est_mvi_asm.lo
 CFLAGS += -fforce-addr
 endif
 
 ifeq ($(TARGET_ARCH_POWERPC),yes)
-OBJS += ppc/dsputil_ppc.o ppc/mpegvideo_ppc.o
+OBJS += ppc/dsputil_ppc.lo ppc/mpegvideo_ppc.lo
 endif
 
 ifeq ($(TARGET_MMI),yes)
-OBJS += ps2/dsputil_mmi.o ps2/idct_mmi.o ps2/mpegvideo_mmi.o
+OBJS += ps2/dsputil_mmi.lo ps2/idct_mmi.lo ps2/mpegvideo_mmi.lo
 endif
 
 ifeq ($(TARGET_ALTIVEC),yes)
-OBJS += ppc/dsputil_altivec.o ppc/mpegvideo_altivec.o ppc/idct_altivec.o \
-        ppc/fft_altivec.o ppc/gmc_altivec.o ppc/fdct_altivec.o \
-        ppc/dsputil_h264_altivec.o
+OBJS += ppc/dsputil_altivec.lo ppc/mpegvideo_altivec.lo ppc/idct_altivec.lo \
+        ppc/fft_altivec.lo ppc/gmc_altivec.lo ppc/fdct_altivec.lo \
+        ppc/dsputil_h264_altivec.lo
 endif
 
 ifeq ($(TARGET_ARCH_SH4),yes)
-OBJS+= sh4/idct_sh4.o sh4/dsputil_sh4.o sh4/dsputil_align.o
+OBJS+= sh4/idct_sh4.lo sh4/dsputil_sh4.lo sh4/dsputil_align.lo
 endif
 
 ifeq ($(TARGET_ARCH_SPARC),yes)
-OBJS+=sparc/dsputil_vis.o
-sparc/%.o: sparc/%.c
-	$(CC) -mcpu=ultrasparc -mtune=ultrasparc $(CFLAGS) -c -o $@ $<
+OBJS+=sparc/dsputil_vis.lo
+sparc/%.lo: sparc/%.c
+	libtool --mode=compile $(CC) -mcpu=ultrasparc -mtune=ultrasparc $(CFLAGS) -c -o $@ $<
 endif
 ifeq ($(TARGET_ARCH_SPARC64),yes)
 CFLAGS+= -mcpu=ultrasparc -mtune=ultrasparc
 endif
 
-SRCS := $(OBJS:.o=.c) $(ASM_OBJS:.o=.S)
+SRCS := $(OBJS:.lo=.c) $(ASM_OBJS:.lo=.S)
 OBJS := $(OBJS) $(ASM_OBJS)
 
 NAME=avcodec
-LIBAVUTIL= $(SRC_PATH)/libavutil/$(LIBPREF)avutil$(LIBSUF)
-ifeq ($(BUILD_SHARED),yes)
+LIBAVUTIL= $(SRC_PATH)/libavutil/libavutil.la
 LIBVERSION=$(LAVCVERSION)
 LIBMAJOR=$(LAVCMAJOR)
+ifeq ($(BUILD_SHARED),yes)
+RPATH= -rpath $(libdir)
+else
+RPATH=
 endif
 TESTS= imgresample-test dct-test motion-test fft-test
 
-all: $(LIB) $(SLIBNAME)
+all: $(LIB)
 
 amrlibs:
 	$(MAKE) -C amr spclib fipoplib
 
 tests: apiexample cpuid_test $(TESTS)
 
-$(LIB): $(OBJS) $(AMRLIBS)
-	rm -f $@
-	$(AR) rc $@ $(OBJS) $(AMREXTRALIBS)
-	$(RANLIB) $@
-
-$(SLIBNAME): $(OBJS)
-ifeq ($(CONFIG_PP),yes)
-	$(MAKE) -C libpostproc
-endif
-ifeq ($(CONFIG_WIN32),yes)
-	$(CC) $(SHFLAGS) -Wl,--output-def,$(@:.dll=.def) -o $@ $(OBJS) $(EXTRALIBS) $(AMREXTRALIBS)
-	-lib /machine:i386 /def:$(@:.dll=.def)
-else
-	$(CC) $(SHFLAGS) $(LDFLAGS) -o $@ $(OBJS) $(EXTRALIBS) $(AMREXTRALIBS)
-endif
+$(LIB): $(OBJS) $(AMRLIBS) $(EXTRADEPS)
+	libtool --mode=link $(CC) $(LDFLAGS) -o $@ $(OBJS) $(AMREXTRALIBS) $(RPATH) $(EXTRALIBS) -version-number `echo $(LIBVERSION) | tr . :`
 
-dsputil.o: dsputil.c dsputil.h
+dsputil.lo: dsputil.c dsputil.h
 
-libpostproc/libpostproc.a:
+libpostproc/libpostproc.la:
 	$(MAKE) -C libpostproc
 
-%.o: %.c
-	$(CC) $(CFLAGS) $(LIBOBJFLAGS) -c -o $@ $<
+%.lo: %.c
+	libtool --mode=compile $(CC) $(CFLAGS) $(LIBOBJFLAGS) -c -o $@ $<
 
-%.o: %.S
-	$(CC) $(CFLAGS) $(LIBOBJFLAGS) -c -o $@ $<
+%.lo: %.S
+	libtool --mode=compile $(CC) $(CFLAGS) $(LIBOBJFLAGS) -c -o $@ $<
 
 depend: $(SRCS)
 	$(CC) -MM $(CFLAGS) $^ 1>.depend
@@ -473,7 +464,7 @@
 
 # api example program
 apiexample: apiexample.c $(LIB)
-	$(CC) $(CFLAGS) -o $@ $< $(LIB) $(LIBAVUTIL) $(EXTRALIBS) -lm
+	libtool --mode=link $(CC) $(CFLAGS) -o $@ $< $(LIB) $(LIBAVUTIL) $(EXTRALIBS) -lm
 
 # cpuid test
 cpuid_test: i386/cputest.c
@@ -485,46 +476,32 @@
 	$(CC) $(CFLAGS) -DTEST -o $@ $^ -lm
 
 dct-test: dct-test.o fdctref.o $(LIB)
-	$(CC) -o $@ $^ -lm $(LIBAVUTIL)
+	libtool --mode=link $(CC) -o $@ $^ -lm $(LIBAVUTIL)
 
 motion-test: motion_test.o $(LIB)
-	$(CC) -o $@ $^ -lm
+	libtool --mode=link $(CC) -o $@ $^ -lm
 
 fft-test: fft-test.o $(LIB)
-	$(CC) -o $@ $^ $(LIBAVUTIL) -lm
+	libtool --mode=link $(CC) -o $@ $^ $(LIBAVUTIL) -lm
 
-ifeq ($(BUILD_SHARED),yes)
 install: all install-headers
-ifeq ($(CONFIG_WIN32),yes)
-	install $(INSTALLSTRIP) -m 755 $(SLIBNAME) "$(prefix)"
-else
-	install -d $(libdir)
-	install $(INSTALLSTRIP) -m 755 $(SLIBNAME) \
-		$(libdir)/$(SLIBNAME_WITH_VERSION)
-	ln -sf $(SLIBNAME_WITH_VERSION) \
-		$(libdir)/$(SLIBNAME_WITH_MAJOR)
-	ln -sf $(SLIBNAME_WITH_VERSION) \
-		$(libdir)/$(SLIBNAME)
-	$(LDCONFIG) || true
-endif
 ifeq ($(CONFIG_PP),yes)
 	$(MAKE) -C libpostproc $@
 endif
-else
-install:
-endif
+	install -d $(DESTDIR)$(libdir)
+	libtool --mode=install install $(INSTALLSTRIP) $(LIB) $(DESTDIR)$(libdir)
 
 installlib: all install-headers
-	install -m 644 $(LIB) "$(libdir)"
+	libtool --mode=install install -m 644 $(LIB) "$(DESTDIR)$(libdir)"
 
 install-headers:
-	mkdir -p "$(prefix)/include/ffmpeg"
+	install -d "$(DESTDIR)$(prefix)/include/ffmpeg"
 	install -m 644 $(SRC_PATH)/libavcodec/avcodec.h \
-                "$(prefix)/include/ffmpeg"
+                "$(DESTDIR)$(prefix)/include/ffmpeg"
 	install -m 644 $(SRC_PATH)/libavcodec/dsputil.h \
-                "$(prefix)/include/ffmpeg"
-	install -d "$(libdir)/pkgconfig"
-	install -m 644 ../libavcodec.pc "$(libdir)/pkgconfig"
+                "$(DESTDIR)$(prefix)/include/ffmpeg"
+	install -d "$(DESTDIR)$(libdir)/pkgconfig"
+	install -m 644 ../libavcodec.pc "$(DESTDIR)$(libdir)/pkgconfig"
 
 #
 # include dependency files if they exist
--- ffmpeg/libavformat/Makefile.orig	2006-01-27 00:42:29.000000000 +0100
+++ ffmpeg/libavformat/Makefile	2006-01-29 13:58:17.064047000 +0100
@@ -8,81 +8,81 @@
 
 CFLAGS=$(OPTFLAGS) -I.. -I$(SRC_PATH) -I$(SRC_PATH)/libavutil -I$(SRC_PATH)/libavcodec -DHAVE_AV_CONFIG_H -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_GNU_SOURCE
 
-OBJS= utils.o cutils.o os_support.o allformats.o
+OBJS= utils.lo cutils.lo os_support.lo allformats.lo
 PPOBJS=
 
 # demuxers
-OBJS+=mpeg.o mpegts.o mpegtsenc.o ffm.o crc.o img.o img2.o raw.o rm.o \
-      avienc.o avidec.o wav.o mmf.o swf.o au.o gif.o mov.o mpjpeg.o dv.o \
-      yuv4mpeg.o 4xm.o flvdec.o psxstr.o idroq.o ipmovie.o \
-      nut.o wc3movie.o mp3.o westwood.o segafilm.o idcin.o flic.o \
-      sierravmd.o matroska.o sol.o electronicarts.o nsvdec.o asf.o \
-      ogg2.o oggparsevorbis.o oggparsetheora.o oggparseflac.o daud.o
+OBJS+=mpeg.lo mpegts.lo mpegtsenc.lo ffm.lo crc.lo img.lo img2.lo raw.lo rm.lo \
+      avienc.lo avidec.lo wav.lo mmf.lo swf.lo au.lo gif.lo mov.lo mpjpeg.lo dv.lo \
+      yuv4mpeg.lo 4xm.lo flvdec.lo psxstr.lo idroq.lo ipmovie.lo \
+      nut.lo wc3movie.lo mp3.lo westwood.lo segafilm.lo idcin.lo flic.lo \
+      sierravmd.lo matroska.lo sol.lo electronicarts.lo nsvdec.lo asf.lo \
+      ogg2.lo oggparsevorbis.lo oggparsetheora.lo oggparseflac.lo daud.lo
 
 # muxers
 ifeq ($(CONFIG_MUXERS),yes)
-OBJS+= flvenc.o movenc.o asf-enc.o
+OBJS+= flvenc.lo movenc.lo asf-enc.lo
 endif
 
 
 AMROBJS=
 ifeq ($(AMR_NB),yes)
-AMROBJS= amr.o
+AMROBJS= amr.lo
 endif
 ifeq ($(AMR_NB_FIXED),yes)
-AMROBJS= amr.o
+AMROBJS= amr.lo
 endif
 ifeq ($(AMR_WB),yes)
-AMROBJS= amr.o
+AMROBJS= amr.lo
 endif
 OBJS+= $(AMROBJS)
 
 # image formats
-OBJS+= pnm.o yuv.o png.o jpeg.o gifdec.o sgi.o
-OBJS+= framehook.o
+OBJS+= pnm.lo yuv.lo png.lo jpeg.lo gifdec.lo sgi.lo
+OBJS+= framehook.lo
 
 ifeq ($(CONFIG_VIDEO4LINUX),yes)
-OBJS+= grab.o
+OBJS+= grab.lo
 endif
 
 ifeq ($(CONFIG_BKTR),yes)
-OBJS+= grab_bktr.o
+OBJS+= grab_bktr.lo
 endif
 
 ifeq ($(CONFIG_DV1394),yes)
-OBJS+= dv1394.o
+OBJS+= dv1394.lo
 endif
 
 ifeq ($(CONFIG_DC1394),yes)
-OBJS+= dc1394.o
+OBJS+= dc1394.lo
 endif
 
 ifeq ($(CONFIG_AUDIO_OSS),yes)
-OBJS+= audio.o
+OBJS+= audio.lo
 endif
 
-EXTRALIBS += -L../libavutil -lavutil$(BUILDSUF)
+EXTRALIBS += ../libavutil/libavutil.la
 
 ifeq ($(CONFIG_AUDIO_BEOS),yes)
-PPOBJS+= beosaudio.o
+PPOBJS+= beosaudio.lo
 endif
 
 # protocols I/O
-OBJS+= avio.o aviobuf.o
+OBJS+= avio.lo aviobuf.lo
 
 ifeq ($(CONFIG_PROTOCOLS),yes)
-OBJS+= file.o
+OBJS+= file.lo
 ifeq ($(CONFIG_NETWORK),yes)
-OBJS+= udp.o tcp.o http.o rtsp.o rtp.o rtpproto.o
+OBJS+= udp.lo tcp.lo http.lo rtsp.lo rtp.lo rtpproto.lo
 # BeOS and Darwin network stuff
 ifeq ($(NEED_INET_ATON),yes)
-OBJS+= barpainet.o
+OBJS+= barpainet.lo
 endif
 endif
 endif
 
 ifeq ($(CONFIG_LIBOGG),yes)
-OBJS+= ogg.o
+OBJS+= ogg.lo
 endif
 
 ifeq ($(TARGET_ARCH_SPARC64),yes)
@@ -90,68 +90,47 @@
 endif
 
 NAME=avformat
-ifeq ($(BUILD_SHARED),yes)
 LIBVERSION=$(LAVFVERSION)
 LIBMAJOR=$(LAVFMAJOR)
-AVCLIBS+=-lavcodec$(BUILDSUF) -L../libavcodec -lavutil$(BUILDSUF) -L../libavutil
+ifeq ($(BUILD_SHARED),yes)
+RPATH= -rpath $(libdir)
+else
+RPATH=
 endif
+AVCLIBS+=../libavcodec/libavcodec.la ../libavutil/libavutil.la
 
-SRCS := $(OBJS:.o=.c) $(PPOBJS:.o=.cpp)
+SRCS := $(OBJS:.lo=.c) $(PPOBJS:.lo=.cpp)
 
-all: $(LIB) $(SLIBNAME)
+all: $(LIB)
 
 $(LIB): $(OBJS) $(PPOBJS)
-	rm -f $@
-	$(AR) rc $@ $(OBJS) $(PPOBJS)
-	$(RANLIB) $@
-
-$(SLIBNAME): $(OBJS)
-ifeq ($(CONFIG_WIN32),yes)
-	$(CC) $(SHFLAGS) -Wl,--output-def,$(@:.dll=.def) -o $@ $(OBJS) $(PPOBJS) $(AVCLIBS) $(EXTRALIBS)
-	-lib /machine:i386 /def:$(@:.dll=.def)
-else
-	$(CC) $(SHFLAGS) $(LDFLAGS) -o $@ $(OBJS) $(PPOBJS) $(AVCLIBS) $(EXTRALIBS)
+	libtool --mode=link $(CC) $(LDFLAGS) -o $@ $(OBJS) $(PPOBJS) $(AVCLIBS) $(EXTRALIBS) $(RPATH) -version-number `echo $(LIBVERSION) | tr . :`
-endif
 
 depend: $(SRCS)
 	$(CC) -MM $(CFLAGS) $^ 1>.depend
 
-ifeq ($(BUILD_SHARED),yes)
 install: all install-headers
-ifeq ($(CONFIG_WIN32),yes)
-	install $(INSTALLSTRIP) -m 755 $(SLIBNAME) "$(prefix)"
-else
-	install -d $(libdir)
-	install $(INSTALLSTRIP) -m 755 $(SLIBNAME) \
-		$(libdir)/$(SLIBNAME_WITH_VERSION)
-	ln -sf $(SLIBNAME_WITH_VERSION) \
-		$(libdir)/$(SLIBNAME_WITH_MAJOR)
-	ln -sf $(SLIBNAME_WITH_VERSION) \
-		$(libdir)/$(SLIBNAME)
-	$(LDCONFIG) || true
-endif
-else
-install:
-endif
+	install -d $(DESTDIR)$(libdir)
+	libtool --mode=install install $(INSTALLSTRIP) $(LIB) $(DESTDIR)$(libdir)
 
 installlib: all install-headers
-	install -m 644 $(LIB) "$(libdir)"
+	libtool --mode=install install $(LIB) "$(DESTDIR)$(libdir)"
 
 install-headers:
-	mkdir -p "$(prefix)/include/ffmpeg"
+	install -d "$(DESTDIR)$(prefix)/include/ffmpeg"
 	install -m 644 $(SRC_PATH)/libavformat/avformat.h $(SRC_PATH)/libavformat/avio.h \
                 $(SRC_PATH)/libavformat/rtp.h $(SRC_PATH)/libavformat/rtsp.h \
                 $(SRC_PATH)/libavformat/rtspcodes.h \
-                "$(prefix)/include/ffmpeg"
-	install -d "$(libdir)/pkgconfig"
-	install -m 644 ../libavformat.pc "$(libdir)/pkgconfig"
+                "$(DESTDIR)$(prefix)/include/ffmpeg"
+	install -d "$(DESTDIR)$(libdir)/pkgconfig"
+	install -m 644 ../libavformat.pc "$(DESTDIR)$(libdir)/pkgconfig"
 
-%.o: %.c
-	$(CC) $(CFLAGS) $(LIBOBJFLAGS) -c -o $@ $<
+%.lo: %.c
+	libtool --mode=compile $(CC) $(CFLAGS) $(LIBOBJFLAGS) -c -o $@ $<
 
 # BeOS: remove -Wall to get rid of all the "multibyte constant" warnings
-%.o: %.cpp
-	g++ $(subst -Wall,,$(CFLAGS)) -c -o $@ $<
+%.lo: %.cpp
+	libtool --mode=compile g++ $(subst -Wall,,$(CFLAGS)) -c -o $@ $<
 
 clean:
 	rm -f *.o *.d *~ *.a *.lib *.so *.dylib *.dll
--- ffmpeg/libavutil/Makefile.orig	2006-01-27 00:42:29.000000000 +0100
+++ ffmpeg/libavutil/Makefile	2006-01-29 14:10:15.400940250 +0100
@@ -8,41 +8,34 @@
 # NOTE: -I.. is needed to include config.h
 CFLAGS=$(OPTFLAGS) -DHAVE_AV_CONFIG_H -I.. -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_GNU_SOURCE
 
-OBJS= mathematics.o \
-      integer.o \
-      rational.o \
-      intfloat_readwrite.o \
+OBJS= mathematics.lo \
+      integer.lo \
+      rational.lo \
+      intfloat_readwrite.lo \
 
 
 ifeq ($(TARGET_ARCH_SPARC64),yes)
 CFLAGS+= -mcpu=ultrasparc -mtune=ultrasparc
 endif
 
-SRCS := $(OBJS:.o=.c)
+SRCS := $(OBJS:.lo=.c)
 
 NAME=avutil
-ifeq ($(BUILD_SHARED),yes)
 LIBVERSION=$(LAVUVERSION)
 LIBMAJOR=$(LAVUMAJOR)
+ifeq ($(BUILD_SHARED),yes)
+RPATH=-rpath $(libdir)
+else
+RPATH=
 endif
 
-all: $(LIB) $(SLIBNAME)
+all: $(LIB)
 
 $(LIB): $(OBJS)
-	rm -f $@
-	$(AR) rc $@ $(OBJS)
-	$(RANLIB) $@
-
-$(SLIBNAME): $(OBJS)
-ifeq ($(CONFIG_WIN32),yes)
-	$(CC) $(SHFLAGS) -Wl,--output-def,$(@:.dll=.def) -o $@ $(OBJS) $(EXTRALIBS) $(AMREXTRALIBS)
-	-lib /machine:i386 /def:$(@:.dll=.def)
-else
-	$(CC) $(SHFLAGS) $(LDFLAGS) -o $@ $(OBJS) $(EXTRALIBS) $(AMREXTRALIBS)
-endif
+	libtool --mode=link $(CC) $(LDFLAGS) -o $@ $(OBJS) $(EXTRALIBS) $(AMREXTRALIBS) $(LDFLAGS) $(RPATH) -version-number `echo $(LIBVERSION) | tr . :`
 
-%.o: %.c
-	$(CC) $(CFLAGS) $(LIBOBJFLAGS) -c -o $@ $<
+%.lo: %.c
+	libtool --mode=compile $(CC) $(CFLAGS) $(LIBOBJFLAGS) -c -o $@ $<
 
 depend: $(SRCS)
 	$(CC) -MM $(CFLAGS) $^ 1>.depend
@@ -56,38 +49,24 @@
 	rm -f .depend
 
 
-ifeq ($(BUILD_SHARED),yes)
 install: all install-headers
-ifeq ($(CONFIG_WIN32),yes)
-	install $(INSTALLSTRIP) -m 755 $(SLIBNAME) "$(prefix)"
-else
-	install -d $(libdir)
-	install $(INSTALLSTRIP) -m 755 $(SLIBNAME) \
-		$(libdir)/$(SLIBNAME_WITH_VERSION)
-	ln -sf $(SLIBNAME_WITH_VERSION) \
-		$(libdir)/$(SLIBNAME_WITH_MAJOR)
-	ln -sf $(SLIBNAME_WITH_VERSION) \
-		$(libdir)/$(SLIBNAME)
-	$(LDCONFIG) || true
-endif
-else
-install:
-endif
+	install -d $(DESTDIR)$(libdir)
+	libtool --mode=install install $(INSTALLSTRIP) $(LIB) $(DESTDIR)$(libdir)
 
 installlib: all install-headers
-	install -m 644 $(LIB) "$(libdir)"
+	libtool --mode=install install $(LIB) "$(DESTDIR)$(libdir)"
 
 install-headers:
-	mkdir -p "$(prefix)/include/ffmpeg"
+	install -d "$(DESTDIR)$(prefix)/include/ffmpeg"
 	install -m 644 $(SRC_PATH)/libavutil/avutil.h \
 	               $(SRC_PATH)/libavutil/common.h \
 	               $(SRC_PATH)/libavutil/mathematics.h \
 	               $(SRC_PATH)/libavutil/integer.h \
 	               $(SRC_PATH)/libavutil/rational.h \
 	               $(SRC_PATH)/libavutil/intfloat_readwrite.h \
-                "$(prefix)/include/ffmpeg"
-	install -d "$(libdir)/pkgconfig"
-	install -m 644 ../libavutil.pc "$(libdir)/pkgconfig"
+                "$(DESTDIR)$(prefix)/include/ffmpeg"
+	install -d "$(DESTDIR)$(libdir)/pkgconfig"
+	install -m 644 ../libavutil.pc "$(DESTDIR)$(libdir)/pkgconfig"
 
 #
 # include dependency files if they exist
--- ffmpeg/vhook/Makefile.orig	2006-01-27 00:42:30.000000000 +0100
+++ ffmpeg/vhook/Makefile	2006-01-29 14:11:18.492883250 +0100
@@ -27,17 +27,17 @@
 	$(CC) -MM $(CFLAGS) $^ 1>.depend
 
 install:
-	install -d "$(libdir)/vhook"
-	install -m 755 $(HOOKS) "$(libdir)/vhook"
+	install -d "$(DESTDIR)$(libdir)/vhook"
+	install -m 755 $(HOOKS) "$(DESTDIR)$(libdir)/vhook"
 
 imlib2$(SLIBSUF): imlib2.o
-	$(CC) $(LDFLAGS) -g -o $@ $(SHFLAGS) $< -lImlib2
+	$(CC) $(LDFLAGS) -o $@ $(SHFLAGS) $< -lImlib2
 
 drawtext$(SLIBSUF): drawtext.o
-	$(CC) $(LDFLAGS) -g -o $@ $(SHFLAGS) $< `freetype-config --libs`
+	$(CC) $(LDFLAGS) -o $@ $(SHFLAGS) $< `freetype-config --libs`
 
 %$(SLIBSUF): %.o
-	$(CC) $(LDFLAGS) -g -o $@ $(SHFLAGS) $<
+	$(CC) $(LDFLAGS) -o $@ $(SHFLAGS) $<
 
 clean:
 	rm -f *.o *.d *~ *.a *.lib *.so *.dylib *.dll
--- ffmpeg/Makefile.orig	2006-01-27 00:42:27.000000000 +0100
+++ ffmpeg/Makefile	2006-01-29 14:14:13.291807500 +0100
@@ -7,7 +7,6 @@
 VPATH=$(SRC_PATH)
 
 CFLAGS=$(OPTFLAGS) -I. -I$(SRC_PATH) -I$(SRC_PATH)/libavutil -I$(SRC_PATH)/libavcodec -I$(SRC_PATH)/libavformat -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_GNU_SOURCE
-LDFLAGS+= -g
 
 ifeq ($(TARGET_GPROF),yes)
 CFLAGS+=-p
@@ -36,11 +35,7 @@
 EXTRALIBS+=-lmedia -lbe
 endif
 
-ifeq ($(BUILD_SHARED),yes)
-DEP_LIBS=libavcodec/$(SLIBPREF)avcodec$(SLIBSUF) libavformat/$(SLIBPREF)avformat$(SLIBSUF)
-else
-DEP_LIBS=libavcodec/$(LIBPREF)avcodec$(LIBSUF) libavformat/$(LIBPREF)avformat$(LIBSUF)
-endif
+DEP_LIBS=libavcodec/libavcodec.la libavformat/libavformat.la
 
 ifeq ($(BUILD_VHOOK),yes)
 VHOOK=videohook
@@ -59,7 +54,7 @@
 
 OBJS = ffmpeg.o ffserver.o cmdutils.o $(FFPLAY_O)
 SRCS = $(OBJS:.o=.c) $(ASM_OBJS:.o=.s)
-FFLIBS = -L./libavformat -lavformat$(BUILDSUF) -L./libavcodec -lavcodec$(BUILDSUF) -L./libavutil -lavutil$(BUILDSUF)
+FFLIBS = libavformat/libavformat.la libavcodec/libavcodec.la libavutil/libavutil.la
 
-all: lib $(PROG_G) $(PROG) $(PROGTEST) $(VHOOK) $(QTFASTSTART) $(DOC)
+all: lib $(PROG) $(PROGTEST) $(VHOOK) $(QTFASTSTART) $(DOC)
 
@@ -68,25 +63,17 @@
 	$(MAKE) -C libavcodec all
 	$(MAKE) -C libavformat all
 
-ffmpeg_g$(EXESUF): ffmpeg.o cmdutils.o .libs
-	$(CC) $(LDFLAGS) -o $@ ffmpeg.o cmdutils.o $(FFLIBS) $(EXTRALIBS)
-
-ffmpeg$(EXESUF): ffmpeg_g$(EXESUF)
-	cp -p $< $@
-	$(STRIP) $@
+ffmpeg$(EXESUF): ffmpeg.o cmdutils.o
+	libtool --mode=link $(CC) $(LDFLAGS) -o $@ ffmpeg.o cmdutils.o $(FFLIBS) $(EXTRALIBS)
 
-ffserver$(EXESUF): ffserver.o .libs
-	$(CC) $(LDFLAGS) $(FFSLDFLAGS) -o $@ ffserver.o $(FFLIBS) $(EXTRALIBS)
+ffserver$(EXESUF): ffserver.o
+	libtool --mode=link $(CC) $(LDFLAGS) $(FFSLDFLAGS) -o $@ ffserver.o $(FFLIBS) $(EXTRALIBS)
 
-ffplay_g$(EXESUF): ffplay.o cmdutils.o .libs
-	$(CC) $(LDFLAGS) -o $@ ffplay.o cmdutils.o $(FFLIBS) $(EXTRALIBS) $(SDL_LIBS)
+ffplay$(EXESUF): ffplay.o cmdutils.o
+	libtool --mode=link $(CC) $(LDFLAGS) -o $@ ffplay.o cmdutils.o $(FFLIBS) $(EXTRALIBS) $(SDL_LIBS)
 
-ffplay$(EXESUF): ffplay_g$(EXESUF)
-	cp -p $< $@
-	$(STRIP) $@
-
-output_example$(EXESUF): output_example.o .libs
-	$(CC) $(LDFLAGS) -o $@ output_example.o $(FFLIBS) $(EXTRALIBS)
+output_example$(EXESUF): output_example.o
+	libtool --mode=link $(CC) $(LDFLAGS) -o $@ output_example.o $(FFLIBS) $(EXTRALIBS)
 
 qt-faststart$(EXESUF): qt-faststart.c
 	$(CC) $(SRC_PATH)/qt-faststart.c -o qt-faststart$(EXESUF)
@@ -100,7 +87,7 @@
 %.o: %.c
 	$(CC) $(CFLAGS) -c -o $@ $<
 
-videohook: .libs
+videohook:
 	$(MAKE) -C vhook all
 
 documentation:
@@ -112,8 +99,8 @@
 	$(MAKE) -C libavutil install
 	$(MAKE) -C libavcodec install
 	$(MAKE) -C libavformat install
-	install -d "$(bindir)"
-	install -c $(INSTALLSTRIP) -m 755 $(PROG) "$(bindir)"
+	install -d "$(DESTDIR)$(bindir)"
+	libtool --mode=install install -c $(INSTALLSTRIP) $(PROG) "$(DESTDIR)$(bindir)"
 
 # create the window installer
 wininstaller: all install
@@ -123,8 +110,8 @@
 install-man:
 ifneq ($(CONFIG_WIN32),yes)
 	if [ -f doc/ffmpeg.1 ] ; then \
-	    install -d "$(mandir)/man1" ; \
-	    install -m 644 $(MANPAGE) "$(mandir)/man1" ; \
+	    install -d "$(DESTDIR)$(mandir)/man1" ; \
+	    install -m 644 $(MANPAGE) "$(DESTDIR)$(mandir)/man1" ; \
 	fi
 endif
 
@@ -148,17 +135,13 @@
 .depend: $(SRCS)
 	$(CC) -MM $(CFLAGS) $(SDL_CFLAGS) $^ 1>.depend
 
-.libs: lib
-	@test -f .libs || touch .libs
-	@for i in $(DEP_LIBS) ; do if $(TEST) $$i -nt .libs ; then touch .libs; fi ; done
-
 clean:
 	$(MAKE) -C libavutil clean
 	$(MAKE) -C libavcodec clean
 	$(MAKE) -C libavformat clean
 	$(MAKE) -C tests clean
 	$(MAKE) -C vhook clean
-	rm -f *.o *.d *~ .libs gmon.out TAGS \
+	rm -f *.o *.d *~ gmon.out TAGS \
 	   $(PROG) $(PROG_G) $(PROGTEST) $(QTFASTSTART)
 
 # Note well: config.log is NOT removed.
--- ffmpeg/configure.orig	2006-01-24 20:57:41.000000000 +0100
+++ ffmpeg/configure	2006-01-29 14:17:56.061729750 +0100
@@ -232,10 +232,10 @@
 LDCONFIG="ldconfig"
 LIBPREF="lib"
 LIBSUF=".a"
-LIB='$(LIBPREF)$(NAME)$(LIBSUF)'
+LIB='$(LIBPREF)$(NAME).la'
 SLIBPREF="lib"
 SLIBSUF=".so"
-SLIBNAME='$(SLIBPREF)$(NAME)$(SLIBSUF)'
+SLIBNAME='$(SLIBPREF)$(NAME).la'
 SLIBNAME_WITH_VERSION='$(SLIBPREF)$(NAME)$(SLIBSUF).$(LIBVERSION)'
 SLIBNAME_WITH_MAJOR='$(SLIBPREF)$(NAME)$(SLIBSUF).$(LIBMAJOR)'
 EXESUF=""
@@ -1331,10 +1331,10 @@
 echo "/* Automatically generated by configure - do not modify! */" > $TMPH
 echo "#define FFMPEG_CONFIGURATION "'"'"$FFMPEG_CONFIGURATION"'"' >> $TMPH
 
-echo "prefix=\$(DESTDIR)$prefix" >> config.mak
-echo "libdir=\$(DESTDIR)$libdir" >> config.mak
-echo "bindir=\$(DESTDIR)$bindir" >> config.mak
-echo "mandir=\$(DESTDIR)$mandir" >> config.mak
+echo "prefix=$prefix" >> config.mak
+echo "libdir=$libdir" >> config.mak
+echo "bindir=$bindir" >> config.mak
+echo "mandir=$mandir" >> config.mak
 echo "MAKE=$make" >> config.mak
 echo "CC=$cc" >> config.mak
 echo "AR=$ar" >> config.mak
